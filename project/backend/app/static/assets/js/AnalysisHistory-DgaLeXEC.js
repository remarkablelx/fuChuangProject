import{u as p}from"./Main-B475vtlw.js";import{_ as h}from"./Logo-DoPk92ps.js";import{c as n,o,a as t,t as l,n as u,j as _,f as y,w as v,v as k,b as x,F as D,r as C,p as b,e as I,m as g}from"./index-DvFSEw6X.js";const H={props:{item:{type:Object,required:!0}},computed:{formattedTime(){return new Date(this.item.time).toLocaleString()},statusText(){return{processing:"分析中",completed:"已完成",expired:"已过期"}[this.item.status]},statusClass(){return`status-${this.item.status}`},isExpiringSoon(){const s=new Date(this.item.expiry);return Math.ceil((s-Date.now())/(1e3*3600*24))<=3},isCompleted(){return this.item.status==="completed"}},methods:{handleDelete(){confirm("确定要永久删除此报告？")&&this.$emit("delete",this.item.id)},handleCheck(){p().setCurrentAnalysisId(this.item.id),this.$emit("check")}},emits:["check","delete"]},S={class:"history-item"},w={class:"time-col"},T={class:"analysis-time"},B={class:"status-col"},M={class:"expiry-col"},Q=["disabled"];function V(s,e,c,r,a,i){return o(),n("div",S,[t("div",w,[t("span",T,l(i.formattedTime),1)]),t("div",B,[t("span",{class:u(["status-badge",i.statusClass])},l(i.statusText),3)]),t("div",M,[t("span",{class:u(["expiry-indicator",{"expiring-soon":i.isExpiringSoon}])},l(c.item.expiry),3)]),t("div",null,[t("button",{class:u(["check-btn",{disabled:!i.isCompleted}]),disabled:!i.isCompleted,onClick:e[0]||(e[0]=(...d)=>i.handleCheck&&i.handleCheck(...d))}," 查看 ",10,Q),t("button",{class:"delete-btn",onClick:e[1]||(e[1]=(...d)=>i.handleDelete&&i.handleDelete(...d))}," 删除 ")])])}const $=h(H,[["render",V],["__scopeId","data-v-eb732724"]]),E={},L={class:"virtual-header"};function N(s,e){return o(),n("div",L,e[0]||(e[0]=[t("div",null,"分析时间",-1),t("div",null,"状态",-1),t("div",null,"有效期",-1),t("div",null,"操作",-1)]))}const j=h(E,[["render",N],["__scopeId","data-v-a352623c"]]),A={components:{HistoryItem:$,HistoryHeader:j},setup(){const s=p(),e=I("");s.fetchHistory();const c=g(()=>s.historyItems?s.historyItems.filter(a=>a.time.includes(e.value)||a.status.includes(e.value)).sort((a,i)=>i.id-a.id):[]);return{searchQuery:e,filteredItems:c,handleDelete:async a=>{await s.deleteItem(a)},historyStore:s}}},F={class:"analysis-history"},q={class:"search-filter"},z={key:0,class:"loading"},O={key:1},U={class:"table-body"},G={key:0,class:"nodata"},J={key:2,class:"error-message"};function K(s,e,c,r,a,i){const d=_("HistoryHeader"),f=_("HistoryItem");return o(),n("section",F,[e[2]||(e[2]=t("h2",{class:"section-title"},"分析历史记录",-1)),t("div",q,[v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=m=>r.searchQuery=m),type:"text",placeholder:"搜索历史记录（时间）"},null,512),[[k,r.searchQuery]])]),r.historyStore.isLoading?(o(),n("div",z," 正在加载历史记录... ")):(o(),n("div",O,[t("div",U,[x(d),(o(!0),n(D,null,C(r.filteredItems,m=>(o(),b(f,{key:m.id,item:m,onDelete:r.handleDelete,onCheck:e[1]||(e[1]=P=>s.$emit("check"))},null,8,["item","onDelete"]))),128)),r.filteredItems.length?y("",!0):(o(),n("div",G,l(r.searchQuery?"无搜索结果":"暂无数据"),1))])])),r.historyStore.error?(o(),n("div",J," 错误: "+l(r.historyStore.error),1)):y("",!0)])}const Y=h(A,[["render",K],["__scopeId","data-v-e19d927b"]]);export{Y as default};
