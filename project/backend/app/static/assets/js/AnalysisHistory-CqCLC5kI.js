import{_ as y}from"./Logo-i7xBpqL9.js";import{c as l,o as i,a as t,t as h,n as _,z as g,u as x,e as m,j as f,f as p,w as D,v as k,b as I,F as w,r as H,l as b,A as S}from"./index-BcGQTUpW.js";const C={props:{item:{type:Object,required:!0}},computed:{formattedTime(){return new Date(this.item.time).toLocaleString()},statusText(){return{processing:"分析中",completed:"已完成",expired:"已过期"}[this.item.status]},statusClass(){return`status-${this.item.status}`},isExpiringSoon(){const r=new Date(this.item.expiry);return Math.ceil((r-Date.now())/(1e3*3600*24))<=3}},methods:{handleDelete(){confirm("确定要永久删除此报告？")&&this.$emit("delete",this.item.id)}},emits:["check","delete"]},E={class:"history-item"},T={class:"time-col"},B={class:"analysis-time"},N={class:"status-col"},$={class:"expiry-col"};function j(r,e,n,s,d,c){return i(),l("div",E,[t("div",T,[t("span",B,h(c.formattedTime),1)]),t("div",N,[t("span",{class:_(["status-badge",c.statusClass])},h(c.statusText),3)]),t("div",$,[t("span",{class:_(["expiry-indicator",{"expiring-soon":c.isExpiringSoon}])},h(n.item.expiry),3)]),t("div",null,[t("button",{class:"check-btn",onClick:e[0]||(e[0]=()=>{})}," 查看 "),t("button",{class:"delete-btn",onClick:e[1]||(e[1]=(...o)=>c.handleDelete&&c.handleDelete(...o))}," 删除 ")])])}const A=y(C,[["render",j],["__scopeId","data-v-c62e294a"]]),L={},z={class:"virtual-header"};function M(r,e){return i(),l("div",z,e[0]||(e[0]=[t("div",null,"分析时间",-1),t("div",null,"状态",-1),t("div",null,"有效期",-1),t("div",null,"操作",-1)]))}const Q=y(L,[["render",M],["__scopeId","data-v-a352623c"]]),V=g("history",()=>{const r=x(),e=m([]),n=m(!1),s=m(null);return{historyItems:e,isLoading:n,error:s,fetchHistory:async()=>{try{n.value=!0;const o=await fetch("/api/history",{headers:{Authorization:`Bearer ${r.token}`}});if(!o.ok)throw new Error("获取失败");const{data:a}=await o.json();e.value=a}catch(o){s.value=o.message,console.error("获取历史记录失败:",o)}finally{n.value=!1}},deleteItem:async o=>{try{const a=await fetch("/api/history",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.token}`},body:JSON.stringify({id:Number(o)})}),u=await a.json();if(!a.ok)throw new Error(u.message||"删除失败");e.value=e.value.filter(v=>v.id!==Number(o))}catch(a){s.value=a.message,console.error("删除失败:",a)}}}}),F={components:{HistoryItem:A,HistoryHeader:Q},setup(){const r=V(),e=m("");r.fetchHistory();const n=S(()=>r.historyItems?r.historyItems.filter(d=>d.time.includes(e.value)||d.status.includes(e.value)):[]);return{searchQuery:e,filteredItems:n,handleDelete:async d=>{await r.deleteItem(d)},historyStore:r}}},O={class:"analysis-history"},q={class:"search-filter"},J={key:0,class:"loading"},U={key:1},G={class:"table-body"},K={key:0,class:"loading"},P={key:2,class:"error-message"};function R(r,e,n,s,d,c){const o=f("HistoryHeader"),a=f("HistoryItem");return i(),l("section",O,[e[1]||(e[1]=t("h2",{class:"section-title"},"分析历史记录",-1)),t("div",q,[D(t("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>s.searchQuery=u),type:"text",placeholder:"搜索历史记录（时间）"},null,512),[[k,s.searchQuery]])]),s.historyStore.isLoading?(i(),l("div",J," 正在加载历史记录... ")):(i(),l("div",U,[t("div",G,[I(o),(i(!0),l(w,null,H(s.filteredItems,u=>(i(),b(a,{key:u.id,item:u,onDelete:s.handleDelete},null,8,["item","onDelete"]))),128)),s.filteredItems.length?p("",!0):(i(),l("div",K,h(s.searchQuery?"无搜索结果":"暂无数据"),1))])])),s.historyStore.error?(i(),l("div",P," 错误: "+h(s.historyStore.error),1)):p("",!0)])}const Y=y(F,[["render",R],["__scopeId","data-v-8a64086e"]]);export{Y as default};
